{% extends "base.html" %}
{% block title %}Courses - EduPlatform{% endblock %}
{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-3 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white"><i class="bi bi-funnel me-2"></i>Filters</div>
                <div class="card-body">
                    <h6 class="fw-bold mb-3">Category</h6>
                    <div class="mb-3">
                        <a href="{{ url_for('courses', level=current_level, sort=current_sort, keyword=keyword) }}" class="btn btn-sm {% if not current_category %}btn-primary{% else %}btn-outline-secondary{% endif %} mb-1">All</a>
                        {% for cat in categories %}{% if not cat['parent_id'] %}
                        <a href="{{ url_for('courses', category=cat['category_id'], level=current_level, sort=current_sort, keyword=keyword) }}" class="btn btn-sm {% if current_category == cat['category_id'] %}btn-primary{% else %}btn-outline-secondary{% endif %} mb-1">{{ cat['category_name'] }}</a>
                        {% endif %}{% endfor %}
                    </div>
                    <hr>
                    <h6 class="fw-bold mb-3">Level</h6>
                    <div class="mb-3">
                        <a href="{{ url_for('courses', category=current_category, sort=current_sort, keyword=keyword) }}" class="btn btn-sm {% if not current_level %}btn-primary{% else %}btn-outline-secondary{% endif %} mb-1">All</a>
                        <a href="{{ url_for('courses', category=current_category, level='beginner', sort=current_sort, keyword=keyword) }}" class="btn btn-sm {% if current_level == 'beginner' %}btn-primary{% else %}btn-outline-secondary{% endif %} mb-1">Beginner</a>
                        <a href="{{ url_for('courses', category=current_category, level='intermediate', sort=current_sort, keyword=keyword) }}" class="btn btn-sm {% if current_level == 'intermediate' %}btn-primary{% else %}btn-outline-secondary{% endif %} mb-1">Intermediate</a>
                        <a href="{{ url_for('courses', category=current_category, level='advanced', sort=current_sort, keyword=keyword) }}" class="btn btn-sm {% if current_level == 'advanced' %}btn-primary{% else %}btn-outline-secondary{% endif %} mb-1">Advanced</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-9">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="mb-0">{% if keyword %}Search: {{ keyword }}{% else %}All Courses{% endif %} <small class="text-muted">({{ courses|length }})</small></h4>
                <div class="btn-group">
                    <a href="{{ url_for('courses', category=current_category, level=current_level, sort='newest', keyword=keyword) }}" class="btn btn-sm {% if current_sort == 'newest' %}btn-primary{% else %}btn-outline-primary{% endif %}">New</a>
                    <a href="{{ url_for('courses', category=current_category, level=current_level, sort='popular', keyword=keyword) }}" class="btn btn-sm {% if current_sort == 'popular' %}btn-primary{% else %}btn-outline-primary{% endif %}">Popular</a>
                    <a href="{{ url_for('courses', category=current_category, level=current_level, sort='rating', keyword=keyword) }}" class="btn btn-sm {% if current_sort == 'rating' %}btn-primary{% else %}btn-outline-primary{% endif %}">Rating</a>
                </div>
            </div>
            {% if courses %}
            <div class="row g-4">
                {% for course in courses %}
                <div class="col-md-6 col-xl-4">
                    <div class="card h-100 course-card shadow-sm">
                        <div class="card-img-top bg-gradient text-white d-flex align-items-center justify-content-center" style="height:130px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);"><i class="bi bi-play-circle display-4"></i></div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="badge bg-info">{{ course['category_name'] or 'General' }}</span>
                                <span class="badge bg-{{ 'success' if course['level'] == 'beginner' else 'warning' if course['level'] == 'intermediate' else 'danger' }}">{{ course['level'] }}</span>
                            </div>
                            <h5 class="card-title">{{ course['title'] }}</h5>
                            <p class="card-text text-muted small text-truncate">{{ course['subtitle'] }}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="text-warning small">{% for i in range(5) %}<i class="bi bi-star{% if i < course['rating_avg']|int %}-fill{% endif %}"></i>{% endfor %}</div>
                                <small class="text-muted"><i class="bi bi-people me-1"></i>{{ course['enrollment_count'] }}</small>
                            </div>
                        </div>
                        <div class="card-footer bg-white">
                            <div class="d-flex justify-content-between align-items-center">
                                {% if course['price'] == 0 %}<span class="text-success fw-bold">Free</span>{% else %}<span class="text-danger fw-bold">${{ course['price'] }}</span>{% endif %}
                                <a href="{{ url_for('course_detail', course_id=course['course_id']) }}" class="btn btn-primary btn-sm">Details</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-5"><i class="bi bi-inbox display-1 text-muted"></i><h4 class="mt-3">No courses found</h4></div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
